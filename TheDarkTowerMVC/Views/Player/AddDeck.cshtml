@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
@using TheDarkTowerMVC.Controllers
@using TheDarkTowerMVC.DTO
@{
    List<GameCardDTO> cards = (List<GameCardDTO>)ViewData["GameCards"];
}

<head>
    <link rel="stylesheet" href="/css/adddeck.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">

</head>

<h1>Create a new Deck! (ᗒᗨᗕ)</h1>

@if (cards == null)
{
        <h2>You don't have any cards! :c </h2>
}
else
{

        <form>
            <label for="name">Deck Name:</label>
            <input id="name" name="name" />
            <br>
            <h2>Select cards to add to your deck: </h2>
            <select name="cardselect" id="cardselect" multiple>
            @foreach (var card in cards)
            {
                @if (card != null)
                {
                                <option value=@card.Name>@card.Name</option>

                }
                else
                {
                                <h2>You don't have any friends! :c </h2>
                }
            }
            </select>
            <br></br>
            <input id="multiple-cards-submit" class="btn action-btn btn-primary btn-lg" type="submit" value="Submit">
        </form>
}

<script>
    var btn = document.querySelector("#multiple-cards-submit");
        btn.addEventListener("click", async e => {
            e.preventDefault();
            var slct=document.getElementById("cardselect");
            var name = document.getElementById("name");
            var options = slct.selectedOptions;

            //var opt;
            //var sub = document.getElementById("#multiple-cards-submit");
             console.log(options);

            //for(var i=0;i<options.length;i++){
            //    opt.push(options[i]);
            //}

            var values = Array.from(options).map(({ value }) => value);
            values.push(name.value);

            console.log(values);

            try {
                var res = await fetch('https://localhost:7148/player/adddeck', {
                    method: "POST",
                    headers: { 'Accept': 'application/json', 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        Cards : values
                    })
                });

                console.log(res);

                if(res.redirected) window.location.href = res.url;

                var obj = await res.json();
                console.log(obj);

                //window.location.href = `${obj}`;
            } catch(e) {
                console.log(e);
            }

        })
</script>