@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
<head>
    <link rel="stylesheet" href="/css/login.css">
    <link rel="stylesheet" href="/css/register.css">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">


</head>


<script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>

<section class="vh-100">

    <div class="container-fluid h-custom">
        <div class="row d-flex justify-content-center align-items-center h-100">
            <div class="col-md-8 col-lg-6 col-xl-4 offset-xl-1">
                <form>
                    <div class="form-outline mb-5">
                        <h1 class="h1 fs-4"> Create an account !</h1>
                    </div>
                    <div class="form-outline mb-4">
                        <input id="username" name="username" class="form-control form-control-lg"
                               placeholder="Enter a valid email address" />
                        <label for="username" class="form-label">Choose a username</label>
                    </div>
                    <br>
                    <div class="form-outline mb-3">
                        <input id="password" type="password" name="password" class="form-control form-control-lg"
                               placeholder="Enter a valid password address" />
                        <label for="password" class="form-label">Password</label>
                    </div>
                    <br>
                    <div class="form-outline mb-2">
                        <select name="file-types" id="file-types">
                            <option value="txt">TXT</option>
                            <option value="pdf">PDF</option>
                        </select>
                    </div>
                    <div class="text-center text-lg-start mt-4 pt-2">
                        <button id="register-btn" class="btn btn-primary btn-lg"
                                style="padding-left: 2.5rem; padding-right: 2.5rem;">
                            Register
                        </button>
                    </div>
                </form>

            </div>
        </div>
    </div>
</section>
<script>
    var btn = document.querySelector("#register-btn");
    btn.addEventListener("click", async e => {
        e.preventDefault();
        var uname = document.querySelector("#username").value;
        var pass = document.querySelector("#password").value;
        var fileType = document.querySelector("#file-types");
        var selectedText = fileType.selectedOptions;

        var values = Array.from(selectedText).map(({ value }) => value);
            values.push(name.value);

        var singleValue = values[0];
        console.log(`${uname} cu parola ${pass} si tipul de fisier ${singleValue}`)

        try {
            var res = await fetch('https://localhost:7148/user/register', {
                method: "POST",
                headers: { 'Accept': 'application/json', 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    Username: uname,
                    Password: pass,
                    FileType: singleValue,
                })
            });

            console.log(res);

            if(res.redirected) window.location.href = res.url;
            var obj = await res.json();
            console.log(obj);

            //window.location.href = `${obj}`;
        } catch(e) {
            console.log(e);
        }

    })
</script>